= Azure Local Load Tools
:toc: macro
:toclevels: 2
:icons: font
:url-docs: docs/main.adoc

image:https://img.shields.io/badge/PowerShell-7.2%2B-blue[PowerShell 7.2+]
image:https://img.shields.io/badge/License-MIT-green[MIT License]
image:https://img.shields.io/badge/VMFleet-2.1.0.0-orange[VMFleet 2.1.0.0]


[CAUTION]
====
**Pre-Release Solution** â€” This project is under active development and has not been officially released.
It should be considered experimental. Scripts, configuration formats, and module interfaces may change without notice.
Use in production environments is not recommended at this time.
====

Comprehensive load testing framework for **Azure Local** (formerly Azure Stack HCI) clusters. Validates storage, network, and compute performance before production workloads are migrated or deployed.

toc::[]

== Overview

Azure Local Load Tools provides an automated, config-driven pipeline for running load tests against Azure Local clusters using multiple industry-standard tools:

[cols="1,1,1,2"]
|===
| Tool | Type | Status | Description

| **VMFleet** | Storage I/O | âœ… Implemented | Fleet VMs running DiskSpd on S2D clusters
| **fio** | Storage I/O | ðŸ”² Planned | Flexible I/O tester for Linux VMs
| **iPerf3** | Network | ðŸ”² Planned | Network throughput and latency testing
| **HammerDB** | Database | ðŸ”² Planned | TPC-C/TPC-H benchmarks against SQL Server
| **stress-ng** | Compute | ðŸ”² Planned | CPU, memory, and I/O stress testing
|===

== Key Features

* **Config-driven**: Master YAML config with tagged variables â†’ per-solution JSON configs
* **Parameterized**: Three-level override chain (explicit param > solution config > master default)
* **Credential management**: Azure Key Vault, interactive, or parameter-based â€” never hardcoded
* **State tracking**: Checkpoint-based resume with JSON state files and mutex locking
* **Structured logging**: JSON-lines per component with correlation IDs
* **Monitoring**: Local PerfMon collection + optional Azure Monitor push
* **Multi-format reports**: PDF (asciidoctor-pdf), DOCX (Pandoc), XLSX (ImportExcel)
* **CI/CD ready**: GitHub Actions primary, Azure DevOps + GitLab CI placeholders

== Quick Start

[source,powershell]
----
# 1. Clone the repository
git clone https://github.com/AzureLocal/azurelocal-loadtools.git
cd azurelocal-loadtools

# 2. Install PowerShell prerequisites
Install-Module powershell-yaml -Force
Install-Module ImportExcel -Force
Install-Module VMFleet -Force

# 3. Copy and edit cluster configuration
cp config/clusters/example-cluster.yml config/clusters/my-cluster.yml
# Edit my-cluster.yml with your cluster details

# 4. Initialize environment
.\src\core\powershell\helpers\Initialize-Environment.ps1 `
    -ClusterConfigPath config\clusters\my-cluster.yml `
    -Solution VMFleet

# 5. Run the full VMFleet pipeline
.\src\solutions\vmfleet\Invoke-VMFleetPipeline.ps1 `
    -ClusterConfigPath config\clusters\my-cluster.yml `
    -ProfilePath config\profiles\vmfleet\general.yml `
    -ReportFormats @('PDF', 'XLSX')
----

== Project Structure

[source]
----
azurelocal-loadtools/
â”œâ”€â”€ config/                     # All configuration
â”‚   â”œâ”€â”€ variables/              # Master config + schema + solution JSONs
â”‚   â”œâ”€â”€ clusters/               # Cluster-specific configs
â”‚   â”œâ”€â”€ profiles/               # Workload profiles per solution
â”‚   â””â”€â”€ credentials/            # Key Vault configuration
â”œâ”€â”€ docs/                       # AsciiDoc documentation (book format)
â”‚   â”œâ”€â”€ chapters/               # 11 chapters
â”‚   â”œâ”€â”€ appendices/             # Variable reference, cmdlet ref, glossary
â”‚   â”œâ”€â”€ diagrams/               # draw.io source files
â”‚   â””â”€â”€ themes/                 # Custom PDF theme
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ powershell/
â”‚   â”‚   â”‚   â”œâ”€â”€ modules/        # 6 core modules
â”‚   â”‚   â”‚   â””â”€â”€ helpers/        # Bootstrap & common functions
â”‚   â”‚   â””â”€â”€ ansible/            # Roles for Linux tool deployment
â”‚   â”œâ”€â”€ solutions/
â”‚   â”‚   â”œâ”€â”€ vmfleet/            # Full implementation
â”‚   â”‚   â”‚   â”œâ”€â”€ scripts/        # 7 pipeline scripts
â”‚   â”‚   â”‚   â””â”€â”€ monitoring/     # 5 metric collection scripts
â”‚   â”‚   â”œâ”€â”€ fio/                # Placeholder
â”‚   â”‚   â”œâ”€â”€ iperf/              # Placeholder
â”‚   â”‚   â”œâ”€â”€ hammerdb/           # Placeholder
â”‚   â”‚   â””â”€â”€ stress-ng/          # Placeholder
â”‚   â””â”€â”€ infrastructure/         # Bicep templates (Key Vault, monitoring)
â”œâ”€â”€ monitoring/                 # Alert rules, counter configs, dashboards
â”œâ”€â”€ reports/                    # Generated reports & templates
â”œâ”€â”€ logs/                       # Structured JSON-lines logs
â”œâ”€â”€ state/                      # Run state files
â”œâ”€â”€ tests/                      # Pester tests & PSScriptAnalyzer
â””â”€â”€ .github/workflows/          # 5 GitHub Actions workflows
----

== Documentation

Full documentation is available in AsciiDoc format at link:{url-docs}[docs/main.adoc]. Build PDF with:

[source,bash]
----
asciidoctor-pdf -a pdf-theme=docs/themes/azurelocal-theme.yml docs/main.adoc
----

== Prerequisites

* PowerShell 7.2+
* `powershell-yaml` module
* `VMFleet` module (for VMFleet solution)
* Azure Local cluster with WinRM access
* Optional: `ImportExcel`, `Az.KeyVault`, `Az.Monitor`, `asciidoctor-pdf`, `pandoc`

== License

This project is licensed under the MIT License â€” see link:LICENSE[LICENSE] for details.
